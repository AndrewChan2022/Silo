#                            Copyright 1991 - 2000
#                 The Regents of the University of California.
#                             All rights reserved.
# 
# This work  was produced at the  University of California, Lawrence Livermore
# National Laboratory  (UC LLNL)  under contract no.   W-7405-ENG-48 (Contract
# 48) between  the U.S.  Department  of Energy (DOE)  and  The Regents  of the
# University  of   California (University)   for   the operation  of UC  LLNL.
# Copyright  is reserved  to     the University for   purposes  of  controlled
# dissemination,   commercialization   through   formal licensing,   or  other
# disposition  under  terms  of Contract   48; DOE  policies, regulations  and
# orders;  and U.S.   statutes.  The  rights of   the  Federal Government  are
# reserved under  Contract 48 subject to the  restrictions agreed  upon by DOE
# and University.
# 
#                                 DISCLAIMER
# 
# This software was prepared as an  account of work sponsored  by an agency of
# the United  States Government. Neither the United  States Government nor the
# University of California  nor any  of their  employees, makes any  warranty,
# express or  implied,  or assumes  any  liability  or responsiblity for   the
# accuracy, completeness,  or   usefullness of   any  information,  apparatus,
# product, or process disclosed, or represents that its use would not infringe
# privately   owned  rights. Reference    herein to   any specific  commercial
# products, process, or service   by trade name, trademark,   manufacturer, or
# otherwise,  does not    necessarily  constitute or    imply its endorsement,
# recommendation,  or  favoring by    the  United  States Government  or   the
# University of California. The views and opinions of authors expressed herein
# do not necessarily state or reflect those of the United States Government or
# the University of  California,  and shall not  be  used for  advertising  or
# product endorsement purposes.
#
# Modifications:
#
#	Robb Matzke, 14 Feb 1997
#	Removed references to *.d files which are no longer used.
#
#	Robb Matzke, 10 Mar 1997
#	The `clean' target removes objects from the library instead of
#	the removing the entire library.
#
#	Robb Matzke, 12 Mar 1997
#	The `pdform.h' file now contains information about when it
#	was generated, where, by whom, and for what machine.
#
#	Robb Matzke, 18 Mar 1997
#	Fixed a spelling mistake.
#
#       Sean Ahern, Tue Feb 24 14:15:25 PST 1998
#	Removed installation of "pdb.h".
#
#       Brad Whitlock, Thu Feb 10 17:24:41 PST 2000
#       Got rid of call to the "whoami" command and replaced it
#       with $USER. Removed LDFLAGS and LIBS from the detect case
#       since they were useless and caused problems on ASCI Red.
#
##############################################################################

##
## Programs and options...
##
@SET_MAKE@
@VARIABLES@

##
## Files...
##
SRC=pdb.c pdbdir.c pdbio.c pdbmm.c pdbx.c pdconv.c pdlow.c pdmemb.c \
    pdpath.c pdrdwr.c
HDR=pdb.h
OBJ=$(SRC:.c=.o)
LIB=$(tmplib)/libsilo.a

PRIVATE_SRC=detect.c
NOT_DISTRIB=pdform.h Makefile.options

.PRECIOUS: $(LIB)

##
## Standard targets...
##
all: $(LIB)

## Note that pdform.h is being removed locally, but is then created as a NULL
## file.  This is done on purpose so that dependency checks work when they
## attempt to read pdform.h.  We remove it because pdform.h may change from
## one machine to another.
clean:
	-$(AR) d $(LIB) $(OBJ)
	$(RM) detect detect.o $(OBJ) pdform.h
	$(RM) .depend
	touch pdform.h

##
## Data conversions depend on the pdform.h header file
## which can be created automatically.
##
pdconv.o: pdform.h

pdform.h: detect
	@echo "/*" > $@
	-@echo " * Generated by $(USER)@`hostname` on `date`" >>$@
	-@echo " * for `uname -a`" >>$@
	@echo " */" >> $@
	./detect >> $@

detect: detect.o
	$(CC) $(CFLAGS) -o $@ detect.o

##
## Other targets...
##
install_lib: $(LIB)
	$(INSTALL_DATA) $(LIB) $(libdir)

##
## Automatic dependency stuff...
##
@TARGETS@
