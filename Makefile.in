# This work  was produced at the  University of California, Lawrence Livermore
# National Laboratory  (UC LLNL)  under contract no.   W-7405-ENG-48 (Contract
# 48) between  the U.S.  Department  of Energy (DOE)  and  The Regents  of the
# University  of   California (University)   for   the operation  of UC  LLNL.
# The  rights  of  the Federal  Government  are  reserved  under  Contract  48
# subject  to  the restrictions  agreed  upon  by  the  DOE and  University as
# allowed under DOE Acquisition Letter 97-1.
#
#                                 DISCLAIMER
#
# This work  was prepared as  an  account  of work  sponsored by an  agency of
# the United  States Government. Neither the United  States Government nor the
# University of California  nor any  of their  employees, makes any  warranty,
# express or  implied,  or assumes  any  liability  or responsiblity for   the
# accuracy, completeness,  or   usefullness of   any  information,  apparatus,
# product, or process disclosed, or represents that its use would not infringe
# privately   owned  rights. Reference    herein to   any specific  commercial
# products, process, or service   by trade name, trademark,   manufacturer, or
# otherwise,  does not    necessarily  constitute or    imply its endorsement,
# recommendation,  or  favoring by    the  United  States Government  or   the
# University of California. The views and opinions of authors expressed herein
# do not necessarily state or reflect those of the United States Government or
# the University of  California,  and shall not  be  used for  advertising  or
# product endorsement purposes.
#
#                        NOTIFICATION OF COMMERCIAL USE
#
# Commercialization  of  this  product is  prohibited  without  notifying  the
# Department  of  Energy  (DOE)  or  Lawrence  Livermore  National  Laboratory
# (LLNL).
#
# Modifications:
#
#       Robb Matzke, 3 Feb 1997
#       Fixed a bug that caused make to go into an infinite loop if a
#       subdirectory was missing or unreadable.
#
#       Robb Matzke, 5 Mar 1997
#       The file `include/stamp-h.in' is now included in the distribution
#       so that `include/config.h.in' appears up to date the first time
#       make is run.
#
#       Sean Ahern, Mon Feb 23 15:22:11 PST 1998
#       I added creation of the file "pubhdr" so that we only have to check 
#       the consistency of the header files and the include directory once.
#
#       Sean Ahern, Tue Feb 24 16:06:58 PST 1998
#       Added checking and creation of the installation/{bin,lib,include}
#       directories.
#
#       Eric Brugger, Wed Aug 19 11:11:47 PDT 1998
#       Removed INSTALL as a file to distribute.  Added BUILD_NOTES,
#       CONFIGURE_NOTES and INSTALL_NOTES as files to distribute.
#
#       Jeremy Meredith, Thu Oct  7 12:16:56 PDT 1999
#       Added Mesa 3.0 targets to the primary MeshTV targets.
#
#       Jeremy Meredith, Fri Jan  7 10:23:37 PST 2000
#       Made Mesa compilation conditional.
#
#       Sean Ahern, Tue Apr 11 16:40:39 PDT 2000
#       Removed "pubhdr".  We don't need to check this.  If we really need to
#       check that the header files are in the right places, we should do that
#       in configure.in.
#
#       Eric Brugger, Fri Jul  7 09:22:10 PDT 2000
#       Add the COPYRIGHT and VERSION files to the list of files to distribute.
#
#       Sean Ahern, Mon Apr 22 10:52:43 PDT 2002
#       Removed use of unproto.
#
##############################################################################

@SET_MAKE@
@VARIABLES@

DISTRIB=BUILD_NOTES CONFIGURE_NOTES COPYRIGHT INSTALL_FAQ INSTALL_NOTES \
        README VERSION acconfig.h configure configure.in

SUBDIRS=silo @SPI@ @MESHTV@ @MESHTVX@

# Same as SUBDIRS except in reverse order!
RSUBDIRS=@MESHTVX@ @MESHTV@ @SPI@ silo


# The following targets were split up so that they would work properly
# with the make on AIX systems.
all:
	@MESA_BUILD@
	for dir in $(SUBDIRS); do (cd $$dir && $(MAKE) $@) || exit 1; done

install: install_dirs
	for dir in $(SUBDIRS); do (cd $$dir && $(MAKE) $@) || exit 1; done

install_bin: install_dirs
	for dir in $(SUBDIRS); do (cd $$dir && $(MAKE) $@) || exit 1; done

install_lib: install_dirs
	for dir in $(SUBDIRS); do (cd $$dir && $(MAKE) $@) || exit 1; done

#
# Make sure that the installation directories exist
#
install_dirs:
	if test ! -d $(exec_prefix); then \
		mkdir $(exec_prefix); \
		chmod 755 $(exec_prefix); \
	fi
	if test ! -d $(bindir); then \
		mkdir $(bindir); \
		chmod 755 $(bindir); \
	fi
	if test ! -d $(libdir); then \
		mkdir $(libdir); \
		chmod 755 $(libdir); \
	fi
	if test ! -d $(includedir); then \
		mkdir $(includedir); \
		chmod 755 $(includedir); \
	fi

clean:
	@MESA_CLEAN@
	for dir in $(RSUBDIRS); do (cd $$dir && $(MAKE) $@) || exit 1; done

distclean:
	@MESA_CLEAN@
	for dir in $(RSUBDIRS); do (cd $$dir && $(MAKE) $@) || exit 1; done
	$(RM) Makefile config.cache config.log config.status
	$(RM) *~ include/*~ include/config.h
	$(RM) include/make-targets include/make-variables
	$(RM) include/make-gnu include/make-std
	$(RM) include/make-depend-gnu include/make-depend-std
	$(RM) include/make-targets-gnu include/make-targets-std

maintainer-clean: distclean
	$(RM) configure include/config.h.in
