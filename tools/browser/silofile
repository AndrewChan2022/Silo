#!/bin/sh

magicFile=silofile.magic
theDir=$(dirname $0)

#
# If we cannot find the magic file, then revert to
# using the ordinary 'file' command and warn the
# user about it.
#
if test ! -f $theDir/$magicFile; then
    echo "$(basename $0) cannot find $magicFile. Reverting to ordinary file command..."
    file $*
    exit 0
fi

#
# Ok, use silofile's magic file with the file command and check that
# we get a known response from it. If not, put the file in the unknown
# file list for later.
#
unknownFiles=
for f in $*; do
    knowIt=$(file -m $theDir/$magicFile $f 2>&1 | grep -v $magicFile)
    if test -n "$(echo $knowIt | grep PDB)" -o \
            -n "$(echo $knowIt | grep HDF4)" -o \
            -n "$(echo $knowIt | grep HDF5)"; then
        echo $knowIt
    else
	unknownFiles="$unknownFiles $f"
    fi
done

#
# If we have any unknown files, use the ordinary file command on them.
#
if test -n "$unknownFiles"; then
    echo "$(basename $0) did not recognize any of the following files..."
    file $unknownFiles
fi
